<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header class="bg-primary text-white text-center py-4">
        <h1 class="display-3 fw-bold">GryphCourse Watch</h1>
    </header>

    <main class="container my-5">
        <div class="project-description mx-auto">
            <h2 class="display-5 mb-4">Welcome to GryphCourse Watch</h2>
            <p>WebAdvisor Watch is your go-to tool for monitoring course availability at the University of Guelph. The website enables you to track specific course sections and promptly receive updates on seat availability. By seamlessly integrating with WebAdvisor, it ensures youâ€™re notified when new spots open up, helping you secure your preferred courses without missing out.</p>
            <p>You'll receive timely updates directly to your email inbox, so you can act quickly and secure your spot.</p>
            <p>With WebAdvisor Watch, navigating course registration becomes more efficient and less stressful. Stay ahead with real-time notifications and make the most of your academic journey!</p>
        </div>

        <div class="field-container">
            <form id="course-form" class=" justify-content-center">
                <select class="form-select me-2 w-25" id="semester-dropdown" aria-label="Semester Section">
                  <option selected>Select Semester</option>
                  <option>Fall</option>
                  <option>Winter</option>
                  <option>Summer</option>
                </select>
                <input type="text" class="form-control me-2 w-25" id="course-code" placeholder="Course Code" aria-label="Course Code">
                <select class="form-select me-2 w-25" id="section-dropdown" aria-label="Course Section">
                    <option selected>Select Section</option>
                </select>
                <div class = "email-submit-button">
                  <input type="email" class="form-control me-2 w-100" id="email" placeholder="Your Email" aria-label="Email">
                  <button class="btn btn-primary" type="submit">Notify Me!</button>
                </div>
                
            </form>
        </div>
        
        <div id="loading-spinner" class="text-center mt-3" style="display: none;">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <div id="warning-message" class="text-center mt-3" style="display: none;">
            <div class="alert alert-warning" role="alert">
                No sections found for this course code during the selected semester.
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      document.getElementById('course-code').disabled = true;
      document.getElementById('section-dropdown').disabled = true;
      document.getElementById('email').disabled = true;
    </script>
    
    
    <script>
      document.getElementById('semester-dropdown').addEventListener('input', function() {
        const semester = this.value;
        if (semester === 'Select Semester') {
          document.getElementById('course-code').value = "";
          document.getElementById('section-dropdown').value = "Select Section";
          document.getElementById('email').disabled.value = "";

          document.getElementById('course-code').disabled = true;
          document.getElementById('section-dropdown').disabled = true;
          document.getElementById('email').disabled = true;
        } 
        else {
          document.getElementById('course-code').disabled = false;
          document.getElementById('section-dropdown').disabled = false;
          document.getElementById('email').disabled = false;
        }
      });
    </script>

    
    <script>
      document.getElementById('course-code').addEventListener('input', function() {
        const courseCode = this.value;
        const sectionDropdown = document.getElementById('section-dropdown');
        const semesterDropdown = document.getElementById('semester-dropdown');
        const selectedSemester = semesterDropdown.value;
        const loadingSpinner = document.getElementById('loading-spinner');
        const warningMessage = document.getElementById('warning-message');

        if (/.*\*\d{4}$/.test(courseCode)) {
            loadingSpinner.style.display = 'block';
            sectionDropdown.disabled = true;
            warningMessage.style.display = 'none'; // Hide warning message initially
            document.getElementById('course-code').disabled = true;

            fetch(`/sections?course_code=${courseCode}&selectedSemester=${selectedSemester}`)
                .then(response => response.json())
                .then(sections => {
                    if (sections.length === 0) {
                        warningMessage.style.display = 'block'; // Show warning message
                        sectionDropdown.innerHTML = '<option selected>Select Section</option>';
                    } else {
                        sectionDropdown.innerHTML = '<option selected>Select Section</option>';
                        sections.forEach(section => {
                            const option = document.createElement('option');
                            option.value = section;
                            option.textContent = section;
                            sectionDropdown.appendChild(option);
                        });
                        sectionDropdown.disabled = false;
                        warningMessage.style.display = 'none'; // Hide warning message
                    }
                })
                .catch(error => {
                    console.error('Error fetching sections:', error);
                    warningMessage.style.display = 'block'; // Show warning message on error
                })
                .finally(() => {
                    loadingSpinner.style.display = 'none';
                    document.getElementById('course-code').disabled = false;
                });
        } else {
            sectionDropdown.innerHTML = '<option selected>Select Section</option>';
            sectionDropdown.disabled = true;
            loadingSpinner.style.display = 'none';
            warningMessage.style.display = 'none'; // Hide warning message
        }
      });
    </script>

</body>
</html>
